define(["exports","./Cartesian2-b4b7b0b3","./when-208fe5b0","./Check-5e798bbf","./Transforms-d5dbea8d","./Math-8386669c"],(function(a,t,e,r,n,i){"use strict";var s={};function o(a,t,e){var r=a+t;return i.CesiumMath.sign(a)!==i.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}s.computeDiscriminant=function(a,t,e){return t*t-4*a*e},s.computeRealRoots=function(a,t,e){if(0===a)return 0===t?[]:[-e/t];if(0===t){if(0===e)return[0,0];var r=Math.abs(e),n=Math.abs(a);return r<n&&r/n<i.CesiumMath.EPSILON14?[0,0]:n<r&&n/r<i.CesiumMath.EPSILON14||(n=-e/a)<0?[]:(r=Math.sqrt(n),[-r,r])}return 0===e?(n=-t/a)<0?[n,0]:[0,n]:(n=o(t*t,-4*a*e,i.CesiumMath.EPSILON14),n<0?[]:(n=-.5*o(t,i.CesiumMath.sign(t)*Math.sqrt(n),i.CesiumMath.EPSILON14),0<t?[n/a,e/n]:[e/n,n/a]))};var u={};function C(a,t,e,r){var n=a,i=t/3,s=e/3,o=r,u=n*s,C=i*o,c=i*i,l=s*s,h=n*s-c;a=n*o-i*s,t=i*o-l,e=4*h*t-a*a;if(e<0){r=u*l<=c*C?-2*i*(d=h)+(m=n)*a:-(m=o)*a+2*s*(d=t);var M=-(r<0?-1:1)*Math.abs(m)*Math.sqrt(-e),m=(f=M-r)/2;m=m<0?-Math.pow(-m,1/3):Math.pow(m,1/3),M=f===M?-m:-d/m,M=d<=0?m+M:-r/(m*m+M*M+d);return u*l<=c*C?[(M-i)/n]:[-o/(M+s)]}var d=h;u=-2*i*h+n*a,l=t,c=-o*a+2*s*t,C=Math.sqrt(e),h=Math.sqrt(3)/2,a=Math.abs(Math.atan2(n*C,-u)/3);M=2*Math.sqrt(-d),t=Math.cos(a),f=M*t;e=M*(-t/2-h*Math.sin(a)),u=2*i<f+e?f-i:e-i,d=n,n=u/d,a=Math.abs(Math.atan2(o*C,-c)/3),o=-o,a=(f=(M=2*Math.sqrt(-l))*(t=Math.cos(a)))+(e=M*(-t/2-h*Math.sin(a)))<2*s?f+s:e+s;var f=o/a;e=-u*a-d*o,a=(s*e-i*(u*o))/(-i*e+s*(d*a));return n<=a?n<=f?a<=f?[n,a,f]:[n,f,a]:[f,n,a]:n<=f?[a,n,f]:a<=f?[a,f,n]:[f,a,n]}u.computeDiscriminant=function(a,t,e,r){var n=t*t,i=e*e;return 18*a*t*e*r+n*i-a*a*27*(r*r)-4*(a*i*e+n*t*r)},u.computeRealRoots=function(a,t,e,r){var n;if(0===a)return s.computeRealRoots(t,e,r);if(0!==t)return 0===e?0===r?(i=-t/a)<0?[i,0,0]:[0,0,i]:C(a,t,0,r):0===r?0===(n=s.computeRealRoots(a,t,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:0<=n[0]?[0,n[0],n[1]]:[n[0],0,n[1]]:C(a,t,e,r);if(0!==e)return 0===r?0===(n=s.computeRealRoots(a,0,e)).Length?[0]:[n[0],0,n[1]]:C(a,0,e,r);if(0===r)return[0,0,0];var i=(i=-r/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[i,i,i]};var c={};function l(a,t,e,r){var n=a*a,o=t-3*n/8,C=e-t*a/2+n*a/8;r=r-e*a/4+t*n/16-3*n*n/256,e=u.computeRealRoots(1,2*o,o*o-4*r,-C*C);if(0<e.length){if(t=-a/4,n=e[e.length-1],Math.abs(n)<i.CesiumMath.EPSILON14){if(a=s.computeRealRoots(1,o,r),2===a.length){e=a[0];var c=a[1];if(0<=e&&0<=c)return r=Math.sqrt(e),a=Math.sqrt(c),[t-a,t-r,t+r,t+a];if(0<=e&&c<0)return[t-(l=Math.sqrt(e)),t+l];if(e<0&&0<=c)return[t-(l=Math.sqrt(c)),t+l]}return[]}if(0<n){c=Math.sqrt(n);var l=(o+n+C/c)/2;C=s.computeRealRoots(1,c,(o+n-C/c)/2),l=s.computeRealRoots(1,-c,l);return 0!==C.length?(C[0]+=t,C[1]+=t,0!==l.length?(l[0]+=t,l[1]+=t,C[1]<=l[0]?[C[0],C[1],l[0],l[1]]:l[1]<=C[0]?[l[0],l[1],C[0],C[1]]:C[0]>=l[0]&&C[1]<=l[1]?[l[0],C[0],C[1],l[1]]:l[0]>=C[0]&&l[1]<=C[1]?[C[0],l[0],l[1],C[1]]:C[0]>l[0]&&C[0]<l[1]?[l[0],C[0],l[1],C[1]]:[C[0],l[0],C[1],l[1]]):C):0!==l.length?(l[0]+=t,l[1]+=t,l):[]}}return[]}function h(a,t,e,r){var n=a*a,o=u.computeRealRoots(1,-2*t,e*a+t*t-4*r,n*r-e*t*a+e*e);if(0<o.length){var C,c,l,h,M=o[0],m=t-M,d=m*m,f=a/2;o=m/2,t=d-4*r,m=d+4*Math.abs(r),d=n-4*M,n=n+4*Math.abs(M);c=M<0||t*n<d*m?(C=(d=Math.sqrt(d))/2,0===d?0:(a*o-e)/d):(C=0===(c=Math.sqrt(t))?0:(a*o-e)/c,c/2),0==f&&0===C?h=l=0:i.CesiumMath.sign(f)===i.CesiumMath.sign(C)?h=M/(l=f+C):l=M/(h=f-C),0==o&&0===c?p=g=0:i.CesiumMath.sign(o)===i.CesiumMath.sign(c)?p=r/(g=o+c):g=r/(p=o-c);var g=s.computeRealRoots(1,l,g),p=s.computeRealRoots(1,h,p);if(0!==g.length)return 0!==p.length?g[1]<=p[0]?[g[0],g[1],p[0],p[1]]:p[1]<=g[0]?[p[0],p[1],g[0],g[1]]:g[0]>=p[0]&&g[1]<=p[1]?[p[0],g[0],g[1],p[1]]:p[0]>=g[0]&&p[1]<=g[1]?[g[0],p[0],p[1],g[1]]:g[0]>p[0]&&g[0]<p[1]?[p[0],g[0],p[1],g[1]]:[g[0],p[0],g[1],p[1]]:g;if(0!==p.length)return p}return[]}function M(a,r){r=t.Cartesian3.clone(e.defaultValue(r,t.Cartesian3.ZERO)),t.Cartesian3.equals(r,t.Cartesian3.ZERO)||t.Cartesian3.normalize(r,r),this.origin=t.Cartesian3.clone(e.defaultValue(a,t.Cartesian3.ZERO)),this.direction=r}c.computeDiscriminant=function(a,t,e,r,n){var i=a*a,s=t*t,o=s*t,u=e*e,C=u*e,c=r*r,l=c*r,h=n*n;return s*u*c-4*o*l-4*a*C*c+18*a*t*e*l-27*i*c*c+i*a*256*(h*n)+n*(18*o*e*r-4*s*C+16*a*u*u-80*a*t*u*r-6*a*s*c+144*i*e*c)+h*(144*a*s*e-27*s*s-128*i*u-192*i*t*r)},c.computeRealRoots=function(a,t,e,r,n){if(Math.abs(a)<i.CesiumMath.EPSILON15)return u.computeRealRoots(t,e,r,n);var s=t/a,o=e/a,C=r/a,c=n/a;a=s<0?1:0;switch(a+=o<0?a+1:a,a+=C<0?a+1:a,a+=c<0?a+1:a){case 0:return l(s,o,C,c);case 1:case 2:return h(s,o,C,c);case 3:case 4:return l(s,o,C,c);case 5:return h(s,o,C,c);case 6:case 7:return l(s,o,C,c);case 8:return h(s,o,C,c);case 9:case 10:return l(s,o,C,c);case 11:return h(s,o,C,c);case 12:case 13:case 14:case 15:return l(s,o,C,c);default:return}},M.clone=function(a,r){if(e.defined(a))return e.defined(r)?(r.origin=t.Cartesian3.clone(a.origin),r.direction=t.Cartesian3.clone(a.direction),r):new M(a.origin,a.direction)},M.getPoint=function(a,r,n){return e.defined(n)||(n=new t.Cartesian3),n=t.Cartesian3.multiplyByScalar(a.direction,r,n),t.Cartesian3.add(a.origin,n,n)};var m={rayPlane:function(a,r,n){e.defined(n)||(n=new t.Cartesian3);var s=a.origin,o=a.direction,u=r.normal;a=t.Cartesian3.dot(u,o);if(!(Math.abs(a)<i.CesiumMath.EPSILON15)&&(a=(-r.distance-t.Cartesian3.dot(u,s))/a,!(a<0)))return n=t.Cartesian3.multiplyByScalar(o,a,n),t.Cartesian3.add(s,n,n)}},d=new t.Cartesian3,f=new t.Cartesian3,g=new t.Cartesian3,p=new t.Cartesian3,v=new t.Cartesian3;m.rayTriangleParametric=function(a,r,n,s,o){o=e.defaultValue(o,!1);var u,C,c,l=a.origin,h=a.direction,M=t.Cartesian3.subtract(n,r,d);a=t.Cartesian3.subtract(s,r,f),n=t.Cartesian3.cross(h,a,g),s=t.Cartesian3.dot(M,n);if(o){if(s<i.CesiumMath.EPSILON6)return;if(w=t.Cartesian3.subtract(l,r,p),(m=t.Cartesian3.dot(w,n))<0||s<m)return;if(u=t.Cartesian3.cross(w,M,v),(C=t.Cartesian3.dot(h,u))<0||s<m+C)return;c=t.Cartesian3.dot(a,u)/s}else{if(Math.abs(s)<i.CesiumMath.EPSILON6)return;s=1/s;var m,w=t.Cartesian3.subtract(l,r,p);if((m=t.Cartesian3.dot(w,n)*s)<0||1<m)return;if(u=t.Cartesian3.cross(w,M,v),(C=t.Cartesian3.dot(h,u)*s)<0||1<m+C)return;c=t.Cartesian3.dot(a,u)*s}return c},m.rayTriangle=function(a,r,n,i,s,o){if(s=m.rayTriangleParametric(a,r,n,i,s),e.defined(s)&&!(s<0))return e.defined(o)||(o=new t.Cartesian3),t.Cartesian3.multiplyByScalar(a.direction,s,o),t.Cartesian3.add(a.origin,o,o)};var w=new M;m.lineSegmentTriangle=function(a,r,n,i,s,o,u){var C=w;if(t.Cartesian3.clone(a,C.origin),t.Cartesian3.subtract(r,a,C.direction),t.Cartesian3.normalize(C.direction,C.direction),o=m.rayTriangleParametric(C,n,i,s,o),!(!e.defined(o)||o<0||o>t.Cartesian3.distance(a,r)))return e.defined(u)||(u=new t.Cartesian3),t.Cartesian3.multiplyByScalar(C.direction,o,u),t.Cartesian3.add(C.origin,u,u)};var R={root0:0,root1:0};function S(a,r,i){e.defined(i)||(i=new n.Interval);var s=a.origin,o=a.direction;a=r.center,r=r.radius*r.radius,a=t.Cartesian3.subtract(s,a,g),r=function(a,t,e,r){if(!((i=t*t-4*a*e)<0)){if(0<i){var n=1/(2*a),i=(e=Math.sqrt(i),(-t+e)*n);n=(-t-e)*n;return i<n?(r.root0=i,r.root1=n):(r.root0=n,r.root1=i),r}if(a=-t/(2*a),0!=a)return r.root0=r.root1=a,r}}(t.Cartesian3.dot(o,o),2*t.Cartesian3.dot(o,a),t.Cartesian3.magnitudeSquared(a)-r,R);if(e.defined(r))return i.start=r.root0,i.stop=r.root1,i}m.raySphere=function(a,t,r){if(r=S(a,t,r),e.defined(r)&&!(r.stop<0))return r.start=Math.max(r.start,0),r};var O=new M;m.lineSegmentSphere=function(a,r,n,i){var s=O;if(t.Cartesian3.clone(a,s.origin),r=t.Cartesian3.subtract(r,a,s.direction),a=t.Cartesian3.magnitude(r),t.Cartesian3.normalize(r,r),i=S(s,n,i),!(!e.defined(i)||i.stop<0||i.start>a))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,a),i};var x=new t.Cartesian3,b=new t.Cartesian3;function y(a,t,e){var r=a+t;return i.CesiumMath.sign(a)!==i.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}m.rayEllipsoid=function(a,e){var r=e.oneOverRadii,i=t.Cartesian3.multiplyComponents(r,a.origin,x);e=t.Cartesian3.multiplyComponents(r,a.direction,b),r=t.Cartesian3.magnitudeSquared(i),a=t.Cartesian3.dot(i,e);if(1<r){if(0<=a)return;i=a*a;var s,o,u=r-1;if(i<(o=(s=t.Cartesian3.magnitudeSquared(e))*u))return;if(o<i){var C,c=a*a-o,l=(C=-a+Math.sqrt(c))/s;i=u/C;return l<i?new n.Interval(l,i):{start:i,stop:l}}return l=Math.sqrt(u/s),new n.Interval(l,l)}return r<1?(u=r-1,c=a*a-(o=(s=t.Cartesian3.magnitudeSquared(e))*u),C=-a+Math.sqrt(c),new n.Interval(0,C/s)):a<0?(s=t.Cartesian3.magnitudeSquared(e),new n.Interval(0,-a/s)):void 0};var P=new t.Cartesian3,N=new t.Cartesian3,q=new t.Cartesian3,L=new t.Cartesian3,I=new t.Cartesian3,E=new n.Matrix3,z=new n.Matrix3,T=new n.Matrix3,U=new n.Matrix3,W=new n.Matrix3,B=new n.Matrix3,V=new n.Matrix3,Z=new t.Cartesian3,A=new t.Cartesian3,D=new t.Cartographic;m.grazingAltitudeLocation=function(a,r){var o=a.origin,u=a.direction;if(!t.Cartesian3.equals(o,t.Cartesian3.ZERO)){var C=r.geodeticSurfaceNormal(o,P);if(0<=t.Cartesian3.dot(u,C))return o}var l=e.defined(this.rayEllipsoid(a,r)),h=r.transformPositionToScaledSpace(u,P),M=(C=t.Cartesian3.normalize(h,h),a=t.Cartesian3.mostOrthogonalAxis(h,L),h=t.Cartesian3.normalize(t.Cartesian3.cross(a,C,N),N),a=t.Cartesian3.normalize(t.Cartesian3.cross(C,h,q),q),E);M[0]=C.x,M[1]=C.y,M[2]=C.z,M[3]=h.x,M[4]=h.y,M[5]=h.z,M[6]=a.x,M[7]=a.y,M[8]=a.z;C=n.Matrix3.transpose(M,z);var m=n.Matrix3.fromScale(r.radii,T);h=n.Matrix3.fromScale(r.oneOverRadii,U),a=W;a[0]=0,a[1]=-u.z,a[2]=u.y,a[3]=u.z,a[4]=0,a[5]=-u.x,a[6]=-u.y,a[7]=u.x,a[8]=0;h=n.Matrix3.multiply(n.Matrix3.multiply(C,h,B),a,B),a=n.Matrix3.multiply(n.Matrix3.multiply(h,m,V),M,V),h=n.Matrix3.multiplyByVector(h,o,I);var d=function(a,e,r,o,u){var C=o*o,l=u*u,h=(a[n.Matrix3.COLUMN1ROW1]-a[n.Matrix3.COLUMN2ROW2])*l,M=u*(o*y(a[n.Matrix3.COLUMN1ROW0],a[n.Matrix3.COLUMN0ROW1],i.CesiumMath.EPSILON15)+e.y),m=a[n.Matrix3.COLUMN0ROW0]*C+a[n.Matrix3.COLUMN2ROW2]*l+o*e.x+r,d=l*y(a[n.Matrix3.COLUMN2ROW1],a[n.Matrix3.COLUMN1ROW2],i.CesiumMath.EPSILON15),f=u*(o*y(a[n.Matrix3.COLUMN2ROW0],a[n.Matrix3.COLUMN0ROW2])+e.z),g=[];if(0==f&&0==d){if(0===(S=s.computeRealRoots(h,M,m)).length)return g;var p=S[0],v=Math.sqrt(Math.max(1-p*p,0));return g.push(new t.Cartesian3(o,u*p,u*-v)),g.push(new t.Cartesian3(o,u*p,u*v)),2===S.length&&(w=S[1],R=Math.sqrt(Math.max(1-w*w,0)),g.push(new t.Cartesian3(o,u*w,u*-R)),g.push(new t.Cartesian3(o,u*w,u*R))),g}var w=h*h+(p=d*d),R=2*(M*h+(v=f*d));p=2*m*h+M*M-p+(e=f*f),v=2*(m*M-v);if(0==w&&0==R&&0==p&&0==v)return g;var S,O=(S=c.computeRealRoots(w,R,p,v,m*m-e)).length;if(0===O)return g;for(var x=0;x<O;++x){var b=S[x],P=b*b,N=Math.max(1-P,0);N=Math.sqrt(N),P=i.CesiumMath.sign(h)===i.CesiumMath.sign(m)?y(h*P+m,M*b,i.CesiumMath.EPSILON12):i.CesiumMath.sign(m)===i.CesiumMath.sign(M*b)?y(h*P,M*b+m,i.CesiumMath.EPSILON12):y(h*P+M*b,m,i.CesiumMath.EPSILON12),P=P*y(d*b,f,i.CesiumMath.EPSILON15);P<0?g.push(new t.Cartesian3(o,u*b,u*N)):0<P?g.push(new t.Cartesian3(o,u*b,u*-N)):0!==N?(g.push(new t.Cartesian3(o,u*b,u*-N)),g.push(new t.Cartesian3(o,u*b,u*N)),++x):g.push(new t.Cartesian3(o,u*b,u*N))}return g}(a,t.Cartesian3.negate(h,P),0,0,1),f=d.length;if(0<f){for(var g=t.Cartesian3.clone(t.Cartesian3.ZERO,A),p=Number.NEGATIVE_INFINITY,v=0;v<f;++v){var w=n.Matrix3.multiplyByVector(m,n.Matrix3.multiplyByVector(M,d[v],Z),Z),R=t.Cartesian3.normalize(t.Cartesian3.subtract(w,o,L),L);R=t.Cartesian3.dot(R,u);p<R&&(p=R,g=t.Cartesian3.clone(w,g))}return a=r.cartesianToCartographic(g,D),p=i.CesiumMath.clamp(p,0,1),h=t.Cartesian3.magnitude(t.Cartesian3.subtract(g,o,L))*Math.sqrt(1-p*p),a.height=h=l?-h:h,r.cartographicToCartesian(a,new t.Cartesian3)}};var k=new t.Cartesian3;m.lineSegmentPlane=function(a,r,n,s){e.defined(s)||(s=new t.Cartesian3);var o=t.Cartesian3.subtract(r,a,k),u=n.normal;r=t.Cartesian3.dot(u,o);if(!(Math.abs(r)<i.CesiumMath.EPSILON6)&&(u=t.Cartesian3.dot(u,a),r=-(n.distance+u)/r,!(r<0||1<r)))return t.Cartesian3.multiplyByScalar(o,r,s),t.Cartesian3.add(a,s,s),s},m.trianglePlaneIntersection=function(a,e,r,n){var i,s,o=n.normal,u=n.distance,C=t.Cartesian3.dot(o,a)+u<0,c=t.Cartesian3.dot(o,e)+u<0;o=t.Cartesian3.dot(o,r)+u<0,u=0;if(u+=C?1:0,u+=c?1:0,1!=(u+=o?1:0)&&2!=u||(i=new t.Cartesian3,s=new t.Cartesian3),1==u){if(C)return m.lineSegmentPlane(a,e,n,i),m.lineSegmentPlane(a,r,n,s),{positions:[a,e,r,i,s],indices:[0,3,4,1,2,4,1,4,3]};if(c)return m.lineSegmentPlane(e,r,n,i),m.lineSegmentPlane(e,a,n,s),{positions:[a,e,r,i,s],indices:[1,3,4,2,0,4,2,4,3]};if(o)return m.lineSegmentPlane(r,a,n,i),m.lineSegmentPlane(r,e,n,s),{positions:[a,e,r,i,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==u){if(!C)return m.lineSegmentPlane(e,a,n,i),m.lineSegmentPlane(r,a,n,s),{positions:[a,e,r,i,s],indices:[1,2,4,1,4,3,0,3,4]};if(!c)return m.lineSegmentPlane(r,e,n,i),m.lineSegmentPlane(a,e,n,s),{positions:[a,e,r,i,s],indices:[2,0,4,2,4,3,1,3,4]};if(!o)return m.lineSegmentPlane(a,r,n,i),m.lineSegmentPlane(e,r,n,s),{positions:[a,e,r,i,s],indices:[0,1,4,0,4,3,2,3,4]}}},a.IntersectionTests=m,a.Ray=M}));