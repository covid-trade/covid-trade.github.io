define(["./AttributeCompression-9711314b","./Transforms-d5dbea8d","./Cartesian2-b4b7b0b3","./when-208fe5b0","./TerrainEncoding-cdabb65b","./IndexDatatype-da7c58eb","./Check-5e798bbf","./Math-8386669c","./OrientedBoundingBox-9c75ee89","./createTaskProcessorWorker","./RuntimeError-7f634f5d","./ComponentDatatype-ce69354e","./WebGLConstants-76bb35d1","./EllipsoidTangentPlane-7dd3130c","./IntersectionTests-eb44dd99","./Plane-06d5a63d"],(function(e,t,i,n,s,r,h,u,o,a,d,p,l,f,c,g){"use strict";var m={clipTriangleAtAxisAlignedThreshold:function(e,t,i,s,r,h){var u,o;n.defined(h)?h.length=0:h=[];var a,d,p,l,f,c,g=t?(u=i<e,o=s<e,r<e):(u=e<i,o=e<s,e<r);t=u+o+g;return 1===t?u?(a=(e-i)/(s-i),d=(e-i)/(r-i),h.push(1),h.push(2),1!==d&&(h.push(-1),h.push(0),h.push(2),h.push(d)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):o?(p=(e-s)/(r-s),l=(e-s)/(i-s),h.push(2),h.push(0),1!==l&&(h.push(-1),h.push(1),h.push(0),h.push(l)),1!==p&&(h.push(-1),h.push(1),h.push(2),h.push(p))):g&&(f=(e-r)/(i-r),c=(e-r)/(s-r),h.push(0),h.push(1),1!==c&&(h.push(-1),h.push(2),h.push(1),h.push(c)),1!==f&&(h.push(-1),h.push(2),h.push(0),h.push(f))):2===t?u||i===e?o||s===e?g||r===e||(d=(e-i)/(r-i),p=(e-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(d),h.push(-1),h.push(1),h.push(2),h.push(p)):(c=(e-r)/(s-r),a=(e-i)/(s-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(c),h.push(-1),h.push(0),h.push(1),h.push(a)):(l=(e-s)/(i-s),f=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(l),h.push(-1),h.push(2),h.push(0),h.push(f)):3!==t&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,s,r,h,u,o,a,d){var p=s-o;s=o-h,h=u-a,u=r-a,r=1/(h*p+s*u),a=t-a,o=e-o,s=(h*o+s*a)*r,a=(-u*o+p*a)*r,r=1-s-a;return n.defined(d)?(d.x=s,d.y=a,d.z=r,d):new i.Cartesian3(s,a,r)},computeLineSegmentLineSegmentIntersection:function(e,t,s,r,h,u,o,a,d){var p=(o-h)*(t-u)-(a-u)*(e-h),l=(s-e)*(t-u)-(r-t)*(e-h);h=(a-u)*(s-e)-(o-h)*(r-t);if(0!=h)return p/=h,h=l/h,0<=p&&p<=1&&0<=h&&h<=1?((d=n.defined(d)?d:new i.Cartesian2).x=e+p*(s-e),d.y=t+p*(r-t),d):void 0}},x=32767,w=16383,C=[],v=[],y=[],B=new i.Cartographic,b=new i.Cartesian3,I=[],A=[],T=[],z=[],M=[],N=new i.Cartesian3,V=new t.BoundingSphere,E=new o.OrientedBoundingBox,R=new i.Cartesian2,H=new i.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return(e=n.defined(e)?e:new O).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],this.second=i[e[++n]],this.ratio=e[++n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return n.defined(this.index)},O.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var S=new i.Cartesian2,U=-1,F=[new i.Cartesian3,new i.Cartesian3],P=[new i.Cartesian3,new i.Cartesian3];function k(t,n){var s=F[++U],r=P[U];s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r);return b=i.Cartesian3.lerp(s,r,t.ratio,b),i.Cartesian3.normalize(b,b),e.AttributeCompression.octEncode(b,n),--U,n}O.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(S=k(this,S)).x},O.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(S=k(this,S)).y};var D=[];function W(e,t,i,s,r,h,u,o,a){if(0!==u.length){for(var d=0,p=0;p<u.length;)p=D[d++].initializeFromClipResult(u,p,o);for(var l=0;l<d;++l){var f,c,g=D[l];g.isIndexed()?(g.newIndex=h[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,a&&(g.normalBuffer=s)):(f=g.getKey(),n.defined(h[f])?g.newIndex=h[f]:(c=e.length,e.push(g.getU()),t.push(g.getV()),i.push(g.getH()),a&&(s.push(g.getNormalX()),s.push(g.getNormalY())),g.newIndex=c,h[f]=c))}3===d?(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex)):4===d&&(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex),r.push(D[0].newIndex),r.push(D[2].newIndex),r.push(D[3].newIndex))}}return D.push(new O),D.push(new O),D.push(new O),D.push(new O),a((function(e,n){var h=e.isEastChild,a=e.isNorthChild,d=h?w:0,p=h?x:w,l=a?w:0,f=a?x:w,c=I,g=A,S=T,U=M;c.length=0,g.length=0,S.length=0,U.length=0;var F=z;F.length=0;for(var P={},k=e.vertices,D=(D=e.indices).subarray(0,e.indexCountWithoutSkirts),X=s.TerrainEncoding.clone(e.encoding),K=X.hasVertexNormals,L=e.exaggeration,Y=0,_=e.vertexCountWithoutSkirts,G=e.minimumHeight,J=e.maximumHeight,Z=new Array(_),j=new Array(_),q=new Array(_),Q=K?new Array(2*_):void 0,$=0,ee=0;$<_;++$,ee+=2){var te=X.decodeTextureCoordinates(k,$,R),ie=X.decodeHeight(k,$)/L,ne=u.CesiumMath.clamp(te.x*x|0,0,x),se=u.CesiumMath.clamp(te.y*x|0,0,x);q[$]=u.CesiumMath.clamp((ie-G)/(J-G)*x|0,0,x),x-(ne=ne<20?0:ne)<20&&(ne=x),x-(se=se<20?0:se)<20&&(se=x),Z[$]=ne,j[$]=se,K&&(te=X.getOctEncodedNormal(k,$,H),Q[ee]=te.x,Q[ee+1]=te.y),(h&&w<=ne||!h&&ne<=w)&&(a&&w<=se||!a&&se<=w)&&(P[$]=Y,c.push(ne),g.push(se),S.push(q[$]),K&&(U.push(Q[ee]),U.push(Q[ee+1])),++Y)}var re=[];re.push(new O),re.push(new O),re.push(new O);var he=[];for(he.push(new O),he.push(new O),he.push(new O),$=0;$<D.length;$+=3){var ue=D[$],oe=D[$+1],ae=D[$+2],de=Z[ue],pe=Z[oe],le=Z[ae];re[0].initializeIndexed(Z,j,q,Q,ue),re[1].initializeIndexed(Z,j,q,Q,oe),re[2].initializeIndexed(Z,j,q,Q,ae),pe=m.clipTriangleAtAxisAlignedThreshold(w,h,de,pe,le,C),pe.length<=0||(le=he[0].initializeFromClipResult(pe,0,re))>=pe.length||(le=he[1].initializeFromClipResult(pe,le,re))>=pe.length||(le=he[2].initializeFromClipResult(pe,le,re),W(c,g,S,U,F,P,m.clipTriangleAtAxisAlignedThreshold(w,a,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K),le<pe.length&&(he[2].clone(he[1]),he[2].initializeFromClipResult(pe,le,re),W(c,g,S,U,F,P,m.clipTriangleAtAxisAlignedThreshold(w,a,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K)))}var fe=h?-x:0,ce=a?-x:0,ge=[],me=[],xe=[],we=[],Ce=Number.MAX_VALUE,ve=-Ce,ye=y;ye.length=0;var Be=i.Ellipsoid.clone(e.ellipsoid),be=(He=i.Rectangle.clone(e.childRectangle)).north,Ie=He.south,Ae=He.east,Te=He.west;for(Ae<Te&&(Ae+=u.CesiumMath.TWO_PI),$=0;$<c.length;++$)ne=(ne=Math.round(c[$]))<=d?(ge.push($),0):p<=ne?(xe.push($),x):2*ne+fe,c[$]=ne,se=(se=Math.round(g[$]))<=l?(me.push($),0):f<=se?(we.push($),x):2*se+ce,g[$]=se,(ie=u.CesiumMath.lerp(G,J,S[$]/x))<Ce&&(Ce=ie),ve<ie&&(ve=ie),S[$]=ie,B.longitude=u.CesiumMath.lerp(Te,Ae,ne/x),B.latitude=u.CesiumMath.lerp(Ie,be,se/x),B.height=ie,Be.cartographicToCartesian(B,b),ye.push(b.x),ye.push(b.y),ye.push(b.z);var ze=t.BoundingSphere.fromVertices(ye,i.Cartesian3.ZERO,3,V),Me=o.OrientedBoundingBox.fromRectangle(He,Ce,ve,Be,E),Ne=(e=new s.EllipsoidalOccluder(Be).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ze.center,ye,3,ze.center,Ce,N),ve-Ce),Ve=new Uint16Array(c.length+g.length+S.length);for($=0;$<c.length;++$)Ve[$]=c[$];var Ee=c.length;for($=0;$<g.length;++$)Ve[Ee+$]=g[$];for(Ee+=g.length,$=0;$<S.length;++$)Ve[Ee+$]=x*(S[$]-Ce)/Ne;var Re,He=r.IndexDatatype.createTypedArray(c.length,F);return K?(Re=new Uint8Array(U),n.push(Ve.buffer,He.buffer,Re.buffer),Re=Re.buffer):n.push(Ve.buffer,He.buffer),{vertices:Ve.buffer,encodedNormals:Re,indices:He.buffer,minimumHeight:Ce,maximumHeight:ve,westIndices:ge,southIndices:me,eastIndices:xe,northIndices:we,boundingSphere:ze,orientedBoundingBox:Me,horizonOcclusionPoint:e}}))}));