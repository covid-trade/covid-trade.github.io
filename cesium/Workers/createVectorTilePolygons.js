define(["./AttributeCompression-9711314b","./Cartesian2-b4b7b0b3","./Color-f81b2784","./when-208fe5b0","./IndexDatatype-da7c58eb","./Math-8386669c","./OrientedBoundingBox-9c75ee89","./createTaskProcessorWorker","./Check-5e798bbf","./Transforms-d5dbea8d","./RuntimeError-7f634f5d","./WebGLConstants-76bb35d1","./EllipsoidTangentPlane-7dd3130c","./IntersectionTests-eb44dd99","./Plane-06d5a63d"],(function(e,a,r,n,t,i,o,s,d,f,c,u,h,l,b){"use strict";var g=new a.Cartesian3,p=new a.Ellipsoid,C=new a.Rectangle,y={min:void 0,max:void 0,indexBytesPerElement:void 0};function I(e,a,n){var t=a.length,i=2+t*o.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,n=0,t=0;t<a;++t)n+=r.Color.packedLength+3+e[t].batchIds.length;return n}(n),s=new Float64Array(i),d=0;s[d++]=e,s[d++]=t;for(var f=0;f<t;++f)o.OrientedBoundingBox.pack(a[f],s,d),d+=o.OrientedBoundingBox.packedLength;var c=n.length;s[d++]=c;for(var u=0;u<c;++u){var h=n[u];r.Color.pack(h.color,s,d),d+=r.Color.packedLength,s[d++]=h.offset,s[d++]=h.count;var l=h.batchIds,b=l.length;s[d++]=b;for(var g=0;g<b;++g)s[d++]=l[g]}return s}var m=new a.Cartesian3,w=new a.Cartesian3,v=new a.Cartesian3,x=new a.Cartesian3,A=new a.Cartesian3,E=new a.Cartographic,N=new a.Rectangle;return s((function(s,d){var f;u=s.packedBuffer,f=new Float64Array(u),u=0,y.indexBytesPerElement=f[u++],y.min=f[u++],y.max=f[u++],a.Cartesian3.unpack(f,3,g),u+=a.Cartesian3.packedLength,a.Ellipsoid.unpack(f,u,p),u+=a.Ellipsoid.packedLength,a.Rectangle.unpack(f,u,C);var c=new(2===y.indexBytesPerElement?Uint16Array:Uint32Array)(s.indices),u=new Uint16Array(s.positions),h=new Uint32Array(s.counts),l=new Uint32Array(s.indexCounts),b=new Uint32Array(s.batchIds),T=new Uint32Array(s.batchTableColors),k=new Array(h.length),B=g,L=p,O=C,U=y.min,P=y.max,F=s.minimumHeights,S=s.maximumHeights;n.defined(F)&&n.defined(S)&&(F=new Float32Array(F),S=new Float32Array(S));var R=u.length/2,D=u.subarray(0,R),M=u.subarray(R,2*R);e.AttributeCompression.zigZagDeltaDecode(D,M);for(var _=new Float64Array(3*R),G=0;G<R;++G){var Y=D[G],V=M[G];Y=i.CesiumMath.lerp(O.west,O.east,Y/32767),V=i.CesiumMath.lerp(O.south,O.north,V/32767),V=a.Cartographic.fromRadians(Y,V,0,E),V=L.cartographicToCartesian(V,m);a.Cartesian3.pack(V,_,3*G)}var H=h.length,W=new Array(H),z=new Array(H),Z=0,j=0;for(G=0;G<H;++G)W[G]=Z,z[G]=j,Z+=h[G],j+=l[G];var q=new Float32Array(3*R*2),J=new Uint16Array(2*R),K=new Uint32Array(z.length),Q=new Uint32Array(l.length),X=[],$={};for(G=0;G<H;++G)te=T[G],n.defined($[te])?($[te].positionLength+=h[G],$[te].indexLength+=l[G],$[te].batchIds.push(G)):$[te]={positionLength:h[G],indexLength:l[G],offset:0,indexOffset:0,batchIds:[G]};var ee,ae=0,re=0;for(te in $)$.hasOwnProperty(te)&&((ie=$[te]).offset=ae,ie.indexOffset=re,ae+=2*ie.positionLength,re+=ee=2*ie.indexLength+6*ie.positionLength,ie.indexLength=ee);var ne=[];for(te in $)$.hasOwnProperty(te)&&(ie=$[te],ne.push({color:r.Color.fromRgba(parseInt(te)),offset:ie.indexOffset,count:ie.indexLength,batchIds:ie.batchIds}));for(G=0;G<H;++G){var te,ie,oe=(ie=$[te=T[G]]).offset,se=3*oe,de=oe,fe=W[G],ce=h[G],ue=b[G],he=U,le=P;n.defined(F)&&n.defined(S)&&(he=F[G],le=S[G]);for(var be=Number.POSITIVE_INFINITY,ge=Number.NEGATIVE_INFINITY,pe=Number.POSITIVE_INFINITY,Ce=Number.NEGATIVE_INFINITY,ye=0;ye<ce;++ye){var Ie=a.Cartesian3.unpack(_,3*fe+3*ye,m);L.scaleToGeodeticSurface(Ie,Ie);var me=L.cartesianToCartographic(Ie,E),we=me.latitude,ve=me.longitude;be=Math.min(we,be),ge=Math.max(we,ge),pe=Math.min(ve,pe),Ce=Math.max(ve,Ce),me=L.geodeticSurfaceNormal(Ie,w),we=a.Cartesian3.multiplyByScalar(me,he,v),ve=a.Cartesian3.add(Ie,we,x),we=a.Cartesian3.multiplyByScalar(me,le,we),we=a.Cartesian3.add(Ie,we,A);a.Cartesian3.subtract(we,B,we),a.Cartesian3.subtract(ve,B,ve),a.Cartesian3.pack(we,q,se),a.Cartesian3.pack(ve,q,se+3),J[de]=ue,J[de+1]=ue,se+=6,de+=2}(O=N).west=pe,O.east=Ce,O.south=be,O.north=ge,k[G]=o.OrientedBoundingBox.fromRectangle(O,U,P,L);var xe=ie.indexOffset,Ae=z[G],Ee=l[G];for(K[G]=xe,ye=0;ye<Ee;ye+=3){var Ne=c[Ae+ye]-fe,Te=c[Ae+ye+1]-fe,ke=c[Ae+ye+2]-fe;X[xe++]=2*Ne+oe,X[xe++]=2*Te+oe,X[xe++]=2*ke+oe,X[xe++]=2*ke+1+oe,X[xe++]=2*Te+1+oe,X[xe++]=2*Ne+1+oe}for(ye=0;ye<ce;++ye){var Be=ye,Le=(ye+1)%ce;X[xe++]=2*Be+1+oe,X[xe++]=2*Le+oe,X[xe++]=2*Be+oe,X[xe++]=2*Be+1+oe,X[xe++]=2*Le+1+oe,X[xe++]=2*Le+oe}ie.offset+=2*ce,ie.indexOffset=xe,Q[G]=xe-K[G]}X=t.IndexDatatype.createTypedArray(q.length/3,X);for(var Oe=ne.length,Ue=0;Ue<Oe;++Ue){for(var Pe=ne[Ue].batchIds,Fe=0,Se=Pe.length,Re=0;Re<Se;++Re)Fe+=Q[Pe[Re]];ne[Ue].count=Fe}return u=I(2===X.BYTES_PER_ELEMENT?t.IndexDatatype.UNSIGNED_SHORT:t.IndexDatatype.UNSIGNED_INT,k,ne),d.push(q.buffer,X.buffer,K.buffer,Q.buffer,J.buffer,u.buffer),{positions:q.buffer,indices:X.buffer,indexOffsets:K.buffer,indexCounts:Q.buffer,batchIds:J.buffer,packedBuffer:u.buffer}}))}));